### 🔄 **專案感知與上下文 (Project Awareness & Context)**

- **優先讀取關鍵文件**：在開始新對話時，總是先閱讀 `README.md` 或其他指導性文件，以理解專案的架構、目標、風格和限制。
- **確認任務**：在開始新任務前，請先檢查任務列表。如果任務未被列出，請與我確認後再開始。
- **遵循既有慣例**：嚴格遵守專案中已有的命名、文件結構和架構模式。
- **強制使用 `uv`**：所有 Python 相關操作（包括執行腳本、安裝套件、運行測試）都**必須**在由 `uv` 管理的虛擬環境 (`.venv`) 中進行。

### 🐍 **Python 環境管理 (uv)**
- **建立虛擬環境**:
  ```bash
  uv venv
  ```
- **啟動虛擬環境**:
  ```bash
  source .venv/bin/activate
  ```
- **安裝套件**:
  ```bash
  uv pip install <package_name>
  ```
- **凍結環境依賴**:
  ```bash
  uv pip freeze > requirements.txt
  ```

### 🧱 **程式碼結構與模組化 (Code Structure & Modularity)**
- **保持文件精簡**：單一文件長度不應超過 500 行。若接近此限制，應將其重構為多個模組或輔助文件。
- **模組化**：按功能或職責將程式碼組織到清晰分離的模組中。對於 AI 代理 (Agent)，結構應如下：
    - `agent.py` - 主要代理的定義與執行邏輯
    - `tools.py` - 代理使用的工具函數
    - `prompts.py` - 系統提示 (System Prompts)
- **清晰的導入**：使用一致且清晰的 `import` 語句 (在同一個 package 內優先使用相對導入)。
- **環境變數**：使用 `python-dotenv` 的 `load_dotenv()` 來載入環境變數。

### 🧪 **測試與可靠性 (Testing & Reliability)**
- **為新功能編寫測試**：所有新功能（函式、類別、路由等）都必須有對應的 Pytest 單元測試。
- **同步更新測試**：在更新任何邏輯後，檢查並更新相關的單元測試。
- **測試目錄結構**：測試應放在 `/tests` 目錄下，並鏡像主應用程式的結構。
  - 每個功能至少包含：
    - 1 個預期使用情境的測試
    - 1 個邊界案例 (edge case) 的測試
    - 1 個失敗情境的測試

### ✅ **任務完成 (Task Completion)**
- **即時回報進度**：完成任務後，應立即回報。
- **記錄新發現的任務**：在開發過程中發現的任何新任務或待辦事項，應立即提出以便追蹤。

### 📎 **風格與慣例 (Style & Conventions)**
- **主要語言**：使用 Python。
- **程式碼風格**：遵循 PEP8 規範，使用型別提示 (Type Hints)，並用 `black` 進行格式化。
- **資料驗證**：使用 `pydantic` 進行資料驗證。
- **框架選擇**：若無特殊指定，API 使用 `FastAPI`，ORM 使用 `SQLAlchemy` 或 `SQLModel`。
- **Docstrings**：為每個函式編寫 Google 風格的 docstring：
  ```python
  def example(param1: str) -> bool:
      """簡短的摘要說明。

      Args:
          param1 (str): 參數的描述。

      Returns:
          bool: 回傳值的描述。
      """
  ```

### 📚 **文件與可解釋性 (Documentation & Explainability)**
- **更新 `README.md`**：當新增功能、變更依賴或修改設定步驟時，需同步更新 `README.md`。
- **註解非顯而易見的程式碼**：確保程式碼對於中階開發者來說是易於理解的。
- **解釋複雜邏輯**：當編寫複雜邏輯時，添加 `# Reason:` 格式的行內註解，解釋「為什麼」這麼做，而不僅僅是「做什麼」。

### 🧠 **AI 行為準則 (AI Behavior Rules)**
- **絕不假設**：若上下文不完整或不明確，必須提問。
- **絕不虛構**：禁止虛構或猜測不存在的函式庫或函式，僅使用已知的、經過驗證的 Python 套件。
- **驗證路徑**：在程式碼或測試中引用任何文件路徑或模組名稱之前，必須確認其存在。
- **禁止擅自刪改**：除非有明確��示，否則絕不刪除或覆蓋現有程式碼。
